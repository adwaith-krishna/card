const ROOT="resources/",IMG_ROOT=ROOT+"img/",SOUND_ROOT=ROOT+"sound/",PATHS={cardBGs:[IMG_ROOT+"cards/card_back0.png",IMG_ROOT+"cards/card_back1.png",IMG_ROOT+"cards/card_back2.png",IMG_ROOT+"cards/card_back3.png",IMG_ROOT+"cards/card_back4.png",IMG_ROOT+"cards/card_back5.png",IMG_ROOT+"cards/card_back6.png",IMG_ROOT+"cards/card_back7.png"],cardFG:IMG_ROOT+"cards/card_front.png",retryBtn:IMG_ROOT+"endscreen/retryBtn.png",sceneBG:IMG_ROOT+"startscreen/background.png",startBtn:IMG_ROOT+"startscreen/startBtn.png",settingsBtn:IMG_ROOT+"startscreen/settingsbtn.png",quitBtn:IMG_ROOT+"startscreen/quitBtn.png",knob:IMG_ROOT+"settingsscreen/knob.png",checkmark:IMG_ROOT+"settingsscreen/checkbox.png",checked:IMG_ROOT+"settingsscreen/checkbox_checked.png",flipSound:SOUND_ROOT+"cardflip.mp3",successSound:SOUND_ROOT+"success.mp3"},STYLE=new PIXI.TextStyle({fontFamily:"Helvetica",fontSize:30,fontWeight:"bold",fill:["#ffffff","#ffffff"],stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!0,wordWrapWidth:440}),ALT_STYLE=JSON.parse(JSON.stringify(STYLE));ALT_STYLE._fontSize=30;const ALT_STYLE2=JSON.parse(JSON.stringify(STYLE));ALT_STYLE2._fontSize=25;const ALT_STYLE3=JSON.parse(JSON.stringify(STYLE));function SceneManager(){this.formattedScenes="",this.WARNING="You did not provide a scene to destroy. Always destroy the previous scene, unless this is called on load.",this.DEST_ERROR="Could not destroy current scene. Scene did not contain a destroySelf function",this.VALID_ERR=" is not a valid scene name. \n\n\tAvailable options: ",this.SCENES=["start","game","settings","end"],this.SCENES.forEach(t=>{this.formattedScenes+="\n\t\t"+t}),this.currentScene=new StartScreen(game.stage)}ALT_STYLE3._fontSize=15,SceneManager.prototype.nextScene=function(t,e){null!==this.currentScene?"function"==typeof this.currentScene.destroySelf?this.currentScene.destroySelf():console.error(this.DEST_ERROR):null===this.currentScene&&console.warn(this.WARNING),this.switchScene(t,e)},SceneManager.prototype.switchScene=function(t,e){switch(t.toLowerCase()){case this.SCENES[0]:setTimeout(()=>{this.currentScene=new StartScreen(game.stage)},0);break;case this.SCENES[1]:setTimeout(()=>{this.currentScene=new Game(game.stage),this.currentScene.init(500)},500);break;case this.SCENES[2]:setTimeout(()=>{this.currentScene=new SettingsScreen(game.stage)},500);break;case this.SCENES[3]:setTimeout(()=>{this.currentScene=new EndScreen(game.stage,e)},500);break;default:console.error(t+this.VALID_ERR+this.formattedScenes)}};let Settings={peekTime:1e3,num_cards:16,num_rows:4,randomEvents:!1};function slideRight(t,e){let i=setInterval(function(){t.x+=10,t.x>game.renderer.width&&(clearInterval(i),e.removeChild(t))},1)}function slideLeft(t,e){let i=setInterval(function(){t.x-=10,t.x<-self.message.width&&(clearInterval(i),e.removeChild(t))},1)}function slideOutandRemove(t,e){const i=JSON.parse(JSON.stringify(t.y)),s=JSON.parse(JSON.stringify(t.x)),n=0-t.width;let r=.1,a=setInterval(function(){t.y>=i&&(t.y=i,clearInterval(a),setTimeout(function(){let e=setInterval(function(){t.skew.x-=.3,t.skew.x<-.3&&clearInterval(e)},1),i=setInterval(function(){t.x=-Math.pow(r,6)+s,r+=.1,t.x<n&&clearInterval(i)},1)},250))},1)}null!==localStorage.getItem("Settings")&&(Settings=JSON.parse(localStorage.getItem("Settings"))),shuffleCards=function(t){for(var e,i,s=t.length;s;)i=Math.floor(Math.random()*s--),e=t[s],t[s]=t[i],t[i]=e;return t};let originalX=[],originalY=[];function stackCards(){GAME.cards.forEach(function(t,e){originalX.push(JSON.parse(JSON.stringify(t.x))),originalY.push(JSON.parse(JSON.stringify(t.y)));var i=setInterval(function(){t.x+=(600-t.x)/2,t.y+=(600-t.y)/2,t.draw(),600===Math.round(t.x)&&(t.x=600,t.y=600,clearInterval(i))},50)})}function layCards(){var t=600;GAME.cards.forEach(function(e,i){var s=originalX[i]-e.x-CARDS_WIDTH/2,n=originalY[i]-e.y-CARDS_HEIGHT/2,r=0;setTimeout(function(){var t=setInterval(function(){e.x-=(s+e.x)/4,e.y-=(n+e.y)/4,e.draw(),4===++r&&clearInterval(t)},100)},t),t-=50})}function Game(t){this.canvas=t,this.CARDS_WIDTH=100,this.CARDS_HEIGHT=145,this.PADDING=30,this.cards=[],this.prevFlipped=null,this.revealed=!1,this.allowFlip=!0,this.nrOfCards=Settings.num_cards,this.nrOfRows=Settings.num_rows,this.enableEvents=Settings.randomEvents,this.paused=!1,this.nrOfMovesMade=0,this.cardContainer=new PIXI.Container,this.score=new PIXI.Text("SCORE: "+this.nrOfMovesMade,STYLE),this.flipSound=new Audio(PATHS.flipSound),this.successSound=new Audio(PATHS.successSound),this.successSound.volume=.1,this.cardContainer.x=0,this.score.x=30,this.peekBtn=new PIXI.Text("PEEK",ALT_STYLE),this.backBtn=new PIXI.Text("BACK",ALT_STYLE),this.resetBtn=new PIXI.Text("RESET",ALT_STYLE),this.menuButtons=[this.peekBtn,this.resetBtn,this.backBtn],this.menuButtons.forEach((t,e)=>{t.y=0===e?100:60+this.menuButtons[e-1].y,t.x=30,t.interactive=!0,t.buttonMode=!0}),this.peekBtn.on("pointerup",()=>this.peek()),this.resetBtn.on("pointerup",()=>this.resetGame()),this.backBtn.on("pointerup",()=>SM.nextScene("start"))}function Card(t,e,i,s,n){this.canvas=i,this.value=t,this.x=s,this.y=n,this.flipped=!1,this.inactive=!1,this.backView=new PIXI.Sprite(PIXI.loader.resources[e].texture),this.frontView=new PIXI.Sprite(PIXI.loader.resources[PATHS.cardFG].texture),this.backView.interactive=!0,this.backView.buttonMode=!0,this.backView.anchor.set(.5),this.backView.scale.x=0,this.frontView.interactive=!0,this.frontView.buttonMode=!0,this.frontView.anchor.set(.5)}function Knob(t,e,i,s){this.view=new PIXI.Graphics,this.view.interactive=!0,this.view.buttonMode=!0,this.view.position.x=i-this.view.width/2,this.view.position.y=s-this.view.height/2,this.view.width=this.view.height=2*t,this.view.beginFill(e),this.view.lineStyle(1,0,1),this.view.drawRect(-25,-25,50,50)}Game.prototype.init=function(t){PIXI.loader.reset(),PIXI.loader.add(PATHS.cardFG).add(PATHS.cardBGs).load(()=>{this.canvas.addChild(this.cardContainer),this.createCards(),this.cards=shuffleCards(this.cards),this.setCardCoordinates(),this.drawCards(t,this.canvas),this.cards.forEach(t=>{t.frontView.on("pointerup",()=>this.onCardClick(t))}),this.enableEvents&&this.randomEvent()})},Game.prototype.showAll=function(){this.cards.forEach(t=>{t.flipOver(),this.revealed=!0})},Game.prototype.hideAll=function(){this.cards.forEach(t=>{t.flipBack(),this.revealed=!1})},Game.prototype.peek=function(){this.nrOfMovesMade+=4,this.score.text="SCORE: "+this.nrOfMovesMade,this.showAll(),setTimeout(()=>{this.hideAll()},1e3)},Game.prototype.onCardClick=function(t){var e=this;!0===this.allowFlip&&(this.cards.forEach(function(i){i.value===t.value&&!0===i.flipped&&i!==t?e.removeCards(t,i):!0===i.flipped&&i.value!=t.value&&e.resetCards(t,i)}),t.flipOver(),e.flipSound.play(),e.gameOver())},Game.prototype.removeCards=function(t,e){var i=this;i.allowFlip=!1,i.cards.splice(i.cards.indexOf(t),1),i.cards.splice(i.cards.indexOf(e),1),i.successSound.play(),t.removeCard(),e.removeCard(),setTimeout(function(){i.allowFlip=!0},1e3)},Game.prototype.resetCards=function(t,e){this.allowFlip=!1,this.score.text="SCORE: "+this.nrOfMovesMade++,t.flipBack(),e.flipBack(),setTimeout(()=>{this.allowFlip=!0},500)},Game.prototype.gameOver=function(){0===this.cards.length&&setTimeout(()=>{SM.nextScene("end",this.nrOfMovesMade)},1500)},Game.prototype.drawCards=function(t,e){var i=this;i.cards.forEach(function(s){setTimeout(function(){s.draw()},t),setTimeout(function(){i.menuButtons.forEach(function(t){e.addChild(t)}),e.addChild(i.score)},t),t+=20})},Game.prototype.createCards=function(){for(let t=0;t<2;t++)for(let t=0;t<this.nrOfCards/2;t++)this.cards.push(new Card(t,PATHS.cardBGs[t],this.cardContainer))},Game.prototype.setCardCoordinates=function(){const t=this.CARDS_WIDTH/2,e=document.body.clientWidth/2,i=this.CARDS_HEIGHT/2,s=e-((this.CARDS_WIDTH+this.PADDING)*(this.nrOfCards/this.nrOfRows)-this.PADDING)/2+t,n=i+20;let r=0;for(let t=0;t<this.nrOfRows;t++)for(let e=0;e<this.nrOfCards/this.nrOfRows;e++)this.cards[r].x=e*this.CARDS_WIDTH+this.PADDING*e+s,this.cards[r].y=t*this.CARDS_HEIGHT+this.PADDING*t+n,r++},Game.prototype.removeMenuButtons=function(){for(var t=0;t<this.menuButtons.length;t++)slideOutandRemove(this.menuButtons[t])},Game.prototype.destroySelf=function(){this.cards.forEach(function(t){t.removeView()}),this.cards=[],this.menuButtons.forEach(t=>{this.canvas.removeChild(t)}),this.canvas.removeChild(this.score)},Game.prototype.resetGame=function(){this.destroySelf(),SM.currentScene=new Game(this.canvas),SM.currentScene.init(0)},Game.prototype.switchTwoCards=function(){shuffleCards(this.cards);var t=this.cards[0],e=this.cards[1];t.startMove(e.x,e.y),e.startMove(t.x,t.y)},Game.prototype.randomEvent=function(){var t=Math.round(5e3+1e4*Math.random());console.log("Seconds to next card switch: "+Math.round(t/1e3)),setTimeout(()=>{this.switchTwoCards(),this.randomEvent()},t)},Card.prototype.draw=function(){this.flipped?(!1===this.backView.visible&&(this.backView.visible=!0),this.backView.x=this.x,this.backView.y=this.y,this.canvas.addChild(this.backView),this.frontView.visible=!1):(!1===this.frontView.visible&&(this.frontView.visible=!0),this.frontView.x=this.x,this.frontView.y=this.y,this.canvas.addChild(this.frontView),this.backView.visible=!1)},Card.prototype.flipOver=function(){var t=this,e=setInterval(function(){t.frontView.scale.x-=.1,t.frontView.scale.x<0&&(t.frontView.scale.x=0,t.flipped=!0,t.draw(),t.backView.scale.x+=.1,t.backView.scale.x>.9&&(t.backView.scale.x=1,clearInterval(e)))},20)},Card.prototype.flipBack=function(){var t=this;setTimeout(()=>{let e=setInterval(()=>{t.backView.scale.x-=.1,t.backView.scale.x<0&&(t.backView.scale.x=0,t.flipped=!1,t.draw(),t.frontView.scale.x+=.1,t.frontView.scale.x>.9&&(t.frontView.scale.x=1,clearInterval(e)))},10)},700)},Card.prototype.removeView=function(){this.canvas.removeChild(this.backView),this.canvas.removeChild(this.frontView)},Card.prototype.removeCard=function(){setTimeout(()=>{let t=setInterval(()=>{this.backView.alpha-=.3,this.backView.alpha<=0&&(this.removeView(),clearInterval(t))},100)},1e3)},Card.prototype.startMove=function(t,e){var i=this.x===t,s=this.x>t,n=this.y>e;if(this.x<t&&!1===i&&!0===s)return void console.log("y");if(this.x>t&&!1===i&&!1===s)return void console.log("u");console.log(this.value+": "+t+", "+e);const r=setInterval(()=>{this.rotation=Math.atan2(e-this.y,t-this.x),this.x+=5*Math.cos(this.rotation),i||this.y===e||(this.y+=5*Math.sin(this.rotation)),this.x>t&&!1===i&&!1===s?this.stopMove(r,t,e):this.x<=t&&!1===i&&!0===s?this.stopMove(r,t,e):this.y>e&&!0===i&&!0===n?this.stopMove(r,t,e):this.y<e&&!0===i&&!1===n&&this.stopMove(r,t,e),this.draw()},1)},Card.prototype.stopMove=function(t,e,i){clearInterval(t),this.x=e,this.y=i};var Slider=function(t,e,i,s,n,r){this.visual=new PIXI.Container,this.SLIDE_LENGTH=e,this.SLIDE_WIDTH=t,this.SLIDE_COLOUR="undefined"!==n?n:8947848,this.KNOB_COLOUR="undefined"!==r?r:16777215,this.SLIDE_X0=0,this.SLIDE_Y0=8*this.SLIDE_WIDTH,i||(this.SLIDE_X0=Math.round(window.innerWidth/2-this.SLIDE_LENGTH/2),this.visual.x=.1);var a=new PIXI.Graphics;a.lineStyle(this.SLIDE_WIDTH,this.SLIDE_COLOUR,1),a.moveTo(this.SLIDE_X0,this.SLIDE_Y0),a.lineTo(this.SLIDE_X0+this.SLIDE_LENGTH,this.SLIDE_Y0),a.interactive=!0,a.buttonMode=!0,a.alpha=.2,a.hitArea=new PIXI.Rectangle(this.SLIDE_X0,this.SLIDE_Y0-this.SLIDE_WIDTH/2,this.SLIDE_LENGTH,this.SLIDE_WIDTH),a.click=function(t){var e=t.data.global;o.view.x=e.x,h.getSliderVal()<33?(Settings.num_cards=8,Settings.num_rows=2,s.text=Settings.num_cards+" cards"):h.getSliderVal()<66?(Settings.num_cards=12,Settings.num_rows=3,s.text=Settings.num_cards+" cards"):h.getSliderVal()<100&&(Settings.num_cards=16,Settings.num_rows=4,s.text=Settings.num_cards+" cards")};var o=new Knob(t,this.KNOB_COLOUR,this.SLIDE_X0,this.SLIDE_Y0),h=this;return o.view.mousedown=o.view.touchstart=function(t){this.data=t,h.alpha=.2,h.dragging=!0},o.view.mouseup=o.view.mouseupoutside=o.view.touchend=o.view.touchendoutside=function(t){h.alpha=1,h.dragging=!1},o.view.mousemove=o.view.touchmove=function(t){if(h.dragging){var e=this.data.data.global;e.x>h.SLIDE_X0&&e.x<h.SLIDE_X0+h.SLIDE_LENGTH&&(this.position.x=e.x,h.getSliderVal()<33?(Settings.num_cards=8,Settings.num_rows=2,s.text=Settings.num_cards+" cards"):h.getSliderVal()<66?(Settings.num_cards=12,Settings.num_rows=3,s.text=Settings.num_cards+" cards"):h.getSliderVal()<100&&(Settings.num_cards=16,Settings.num_rows=4,s.text=Settings.num_cards+" cards"))}},this.visual.addChild(a),this.visual.addChild(o.view),game.stage.addChild(this.visual),this.getSliderVal=function(){return parseInt((o.view.position.x-h.SLIDE_X0)/h.SLIDE_LENGTH*100)},this.setSliderVal=function(t){o.view.position.x=parseInt(t*h.SLIDE_LENGTH/100+h.SLIDE_X0)},this};function Checkmark(t,e,i){this.x=t,this.y=e,this.unchecked=PIXI.Sprite.fromImage(PATHS.checkmark),this.checked=PIXI.Sprite.fromImage(PATHS.checked),this.sprites=[this.unchecked,this.checked],this.sprites.forEach(t=>{t.anchor.set(.5),t.x=this.x,t.y=this.y,t.interactive=!0,t.buttonMode=!0,i.addChild(t)}),this.unchecked.on("pointerdown",()=>this.check()),this.checked.on("pointerdown",()=>this.unCheck()),Settings.randomEvents?(this.checked.visible=!0,this.unchecked.visible=!1):(this.checked.visible=!1,this.unchecked.visible=!0)}function StartScreen(t){this.container=new PIXI.Container,this.background=PIXI.Sprite.fromImage(PATHS.sceneBG),this.container.y=0,this.background.width=game.renderer.width,this.background.height=game.renderer.height,this.startBtn=null,this.settingsBtn=null,this.quitBtn=null,this.buttons=[],this.lines=[],this.BTN_SPACING=170,PIXI.loader.reset(),PIXI.loader.add("startBtn",PATHS.startBtn).add("settingsBtn",PATHS.settingsBtn).add("quitBtn",PATHS.quitBtn).load(()=>{this.startBtn=new PIXI.Sprite(PIXI.loader.resources.startBtn.texture),this.settingsBtn=new PIXI.Sprite(PIXI.loader.resources.settingsBtn.texture),this.quitBtn=new PIXI.Sprite(PIXI.loader.resources.quitBtn.texture),this.buttons.push(this.startBtn,this.settingsBtn,this.quitBtn),this.buttons.forEach((t,e)=>{t.anchor.set(.5),t.x=game.renderer.width/2,t.y=0===e?game.renderer.height/2-(this.startBtn.height/2+100):this.buttons[e-1].y+this.BTN_SPACING,t.interactive=!0,t.buttonMode=!0,0===e?t.on("pointerup",()=>{SM.nextScene("game")}):1===e?t.on("pointerup",()=>{SM.nextScene("settings")}):t.on("pointerup",()=>{window.history.back()}),this.container.addChild(t)}),t.addChild(this.background),t.addChild(this.container)})}function EndScreen(t,e){this.canvas=t,this.message=new PIXI.Text("YOUR SCORE:",STYLE),this.endScore=new PIXI.Text(e,STYLE),this.retryBtn=PIXI.Sprite.fromImage(PATHS.retryBtn),this.elements=[this.message,this.endScore,this.retryBtn],this.elements.forEach((t,e)=>{t.anchor.set(.5),t.x=innerWidth/2,t.y=300+110*e,this.canvas.addChild(t)}),this.endScore.text=void 0===e?0:e,this.retryBtn.interactive=!0,this.retryBtn.buttonMode=!0,this.methodName(padding),this.retryBtn.on("pointerup",()=>this.restartGame())}function SettingsScreen(t){this.canvas=t,this.padding=200,this.valueText=new PIXI.Text("Easy: 0%",ALT_STYLE3),this.diffText=new PIXI.Text("Difficulty ",ALT_STYLE2),this.eventsText=new PIXI.Text("Let cards randomly switch",ALT_STYLE2),this.valueText.y=200,this.valueText.x=innerWidth/2-this.valueText.width/2,this.diffText.y=80,this.diffText.x=innerWidth/2-this.diffText.width/2,this.eventsText.y=this.valueText.y+200,this.eventsText.x=innerWidth/2-this.eventsText.width/2,this.checkmark=new Checkmark(innerWidth/2,this.valueText.y+270,t),this.backBtn=new PIXI.Text("SAVE",ALT_STYLE),this.backBtn.y=this.checkmark.y+200,this.backBtn.x=innerWidth/2-this.backBtn.width/2,this.backBtn.interactive=!0,this.backBtn.buttonMode=!0,this.cancelBtn=new PIXI.Text("CANCEL",ALT_STYLE),this.cancelBtn.y=this.checkmark.y+200,this.cancelBtn.x=innerWidth/2-this.cancelBtn.width/2-100,this.cancelBtn.interactive=!0,this.cancelBtn.buttonMode=!0,t.addChild(this.backBtn),t.addChild(this.valueText),t.addChild(this.diffText),t.addChild(this.eventsText),this.slider=Slider(20,250,!1,this.valueText,14540253,9766720),this.backBtn.on("pointerup",()=>this.saveAndGoBack()),this.cancelBtn.on("pointerup",()=>SM.nextScene("start")),16===Settings.num_cards&&this.slider.setSliderVal(100),12===Settings.num_cards&&this.slider.setSliderVal(50),8===Settings.num_cards&&this.slider.setSliderVal(0),this.valueText.text=Settings.num_cards+" cards"}Checkmark.prototype.check=function(){this.checked.visible=!0,this.unchecked.visible=!1,Settings.randomEvents=!0},Checkmark.prototype.unCheck=function(){this.checked.visible=!1,this.unchecked.visible=!0,Settings.randomEvents=!1},StartScreen.prototype.destroySelf=function(){this.buttons.forEach(t=>{slideOutandRemove(t)})},EndScreen.prototype.restartGame=function(){SM.nextScene("game")},EndScreen.prototype.destroySelf=function(){slideOutandRemove(this.retryBtn),slideOutandRemove(this.message),slideOutandRemove(this.endScore)},SettingsScreen.prototype.setDifficulty=function(){Settings.sliderValue=this.slider.getSliderVal(),this.slider.getSliderVal()<33?(Settings.num_cards=8,Settings.num_rows=2,this.valueText.text="8 cards"):this.slider.getSliderVal()<66?(Settings.num_cards=12,Settings.num_rows=3,this.valueText.text="12 cards"):this.slider.getSliderVal()<100&&(Settings.num_cards=16,Settings.num_rows=4,this.valueText.text="16 cards"),localStorage.setItem("Settings",JSON.stringify(Settings))},SettingsScreen.prototype.destroySelf=function(){this.canvas.removeChild(this.slider.visual)},SettingsScreen.prototype.saveAndGoBack=function(){this.setDifficulty(),SM.nextScene("start")};